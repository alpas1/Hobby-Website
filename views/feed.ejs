<!DOCTYPE html>
<html>
<head>
	<title>Posts from Other Users</title>
	<link rel="stylesheet" href="/feed.css">
  <!-- Bootstrap CSS -->
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/navbars/">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        .navbar {
            z-index: 1 !important;
            background-color: orange !important;
            height: 90px;
          }
         </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-warning">
        <div class="container-fluid">
          <a class="hobbyist navbar-brand" href="/home_page">Hobbyist</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link d-flex flex-column align-items-center" href="/home_page">
                  <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" style="width: 40px; height: 40px;" alt="Profile Picture" class="rounded-circle me-2">
                  <span>Home</span>
                </a>
              </li>
          <li class="nav-item">
            <a class="nav-link d-flex flex-column align-items-center" href="/feed">
              <img src="https://cdn-icons-png.flaticon.com/512/6565/6565268.png" style="width: 40px; height: 40px;" alt="Profile Picture" class="rounded-circle me-2">
              <span>Feed</span>
            </a>
            </li>
              <li class="nav-item dropdown">
                <a class="nav-link d-flex flex-column align-items-center" href="#" id="navbarDropdownFriends" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <img src="	https://cdn-icons-png.flaticon.com/512/10313/10313078.png" style="width: 40px; height: 40px;" alt="Profile Picture" class="rounded-circle me-2">
                  <span>Friends</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownFriends">
                  <li><a class="dropdown-item" href="/connect_with_friends">Connect with Friends</a></li> <!--FIX THIS-->
                  <li><a class="dropdown-item" href="/myFriends_Page">My Friends</a></li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link d-flex flex-column align-items-center" href="/rooms">
                  <img src="https://cdn-icons-png.flaticon.com/512/9234/9234940.png" style="width: 40px; height: 40px;" alt="Profile Picture" class="rounded-circle me-2">
                  <span>Rooms</span>
                </a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link d-flex flex-column align-items-center" href="#" id="navbarDropdownPicture" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <img src=<%=myProfile.profilePicture%> style="width: 40px; height: 40px;" alt="Profile Picture" class="rounded-circle me-2">
                  <span><%=myProfile.user.username%></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownPicture">
                  <li><a class="dropdown-item" href="/profile/<%=myProfile.user.username%>">My Profile</a></li>
            <li><a class="dropdown-item" href="/my_posts">My Posts</a></li> <!--FIX THIS-->
                  <li><a class="dropdown-item" href="/logout">Logout</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
	<main id="main-content">
   
</div>
</div>
<!-- Bootstrap JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

      <script>
        // GET ALL THE POSTS 
          const mainContent = document.getElementById("main-content");
          const posts = JSON.parse('<%-JSON.stringify(friendPosts) %>');
          const postsDetails = JSON.parse('<%-JSON.stringify(friendPostsDetails)%>');
       
          var i = -1;
          posts.forEach(post => {
            i++;
          const post1 = `<div class="posts-container">
      <div class="post" id="post${i}">
        <div class="user-info">
          <img src="${postsDetails[i].profilePicture}" alt="Profile Picture">
          <p>${postsDetails[i].username}</p>
                  <button class="delete-icon" style="display: none;">Delete</button> <!-- fix this -->
        </div>
        <div class="post-content">
          <img src="${post.postPicture}" alt="Post Image">
        </div>
        <div class="post-actions">
          <p class="caption">${post.caption}</p>

          <button class="like-button">
            <img class="like-img" src="https://cdn-icons-png.flaticon.com/512/4406/4406157.png" alt="Like">
           
        </button>
        
          <a href="#" data-toggle="modal" data-target="#commentModal1">
            <img src="	https://cdn-icons-png.flaticon.com/512/2593/2593463.png" width="38px">
          </a>

          <div class="modal fade" id="commentModal1" tabindex="-1" role="dialog" aria-labelledby="commentModalLabel1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="commentModalLabel">Comments</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary" id="poster">Post</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
          </div>`
          mainContent.innerHTML += post1;
          const modalBody = `
          <hr>
              <div class="d-flex align-items-center">
                <div class="pr-3">
                  <img src="https://via.placeholder.com/50" class="rounded-circle" alt="User Avatar">
                </div>
                <div class="flex-grow-1">
                  <p><strong>Username:</strong> This is a comment on post number 1.</p>
                  <a href="#" class="pl-2"><small>Like</small></a>
                  <a href="#" class="pl-2"><small>Reply</small></a>
                  <a href="#" class="pl-2"><small>Report</small></a>
                  <small class="pl-2">4 hours ago</small>
                </div>
              </div>`
        })

        var likeButtons = document.querySelectorAll(".like-button");
        var likeImgs = document.querySelectorAll(".like-img");
        var isLiked = [];


        for (i = 0; i < likeButtons.length; i++) {
           if (posts[i].likes.includes('<%=myProfile.user.username%>')){
            isLiked.push(true);
            likeImgs[i].src = 'https://cdn-icons-png.flaticon.com/512/4406/4406155.png';
          }
          else {
            isLiked.push(false);
            likeImgs[i].src = 'https://cdn-icons-png.flaticon.com/512/4406/4406157.png';
          }
            likeButtons[i].addEventListener("click", createClickListener(i));
        }


        function createClickListener(index) {
        
            return async function() {
             
              const posts = JSON.parse('<%-JSON.stringify(friendPosts) %>');
            
              const postId=posts[index]._id;
                if (isLiked[index]) {
                    // remove from likes
                    const response = await fetch (`/posts/${postId}/unlike`, {
                      method: 'POST',
                      headers: {"Content-Type":"application/json; charset=UTF-8" }
                    });

                    if (response.ok) {
                    likeImgs[index].src = "https://cdn-icons-png.flaticon.com/512/4406/4406157.png";
                    isLiked[index] = false;
                  }
                    else {
                      alert("Something went wrong. Try again later!");
                    }
                } else {
                     // add to likes
                    const response = await fetch(`/posts/${postId}/like`, {
                    method: 'POST',
                    headers: {"Content-Type":"application/json; charset=UTF-8" }
                  });

                    if (response.ok) {
                    likeImgs[index].src = "https://cdn-icons-png.flaticon.com/512/4406/4406155.png";
                    isLiked[index] = true;
                  }
                    else {
                      alert("Something went wrong. Try again later!");
                    }
                }
            }
        }
        </script>
      </script>