<!DOCTYPE html>
<html>
  <head>
    <title>Profile Page</title>
    <link rel="stylesheet" type="text/css" href="/profile_page.css">
    <script src="/city_dictionary.js"></script>
    <style>

        body {
          background-image: url('https://img.freepik.com/free-photo/flay-lay-workspace-with-copy-space_23-2148219328.jpg?size=626&ext=jpg&ga=GA1.1.522147423.1681298055&semt=robertav1_2_sidr');
          background-size: cover;
          background-attachment: fixed;
        }

        #form-container {
          border: 1px solid black;
          max-width: 500px;
          margin: 0 auto;
          height: 400px;
          overflow-y: scroll;
        }

        img {
          border-radius: 50%;
          aspect-ratio: 1/1;
          width: 200px;
          height: 200px;
          object-fit: cover;
          cursor: pointer; /* added this to show the image is clickable */
          margin-left: auto;
          margin-right: auto;
        }

        #imageInput {
          display: none; /* added this to hide the file input */
        }

        .container {
          display: flex;
          justify-content: center;
          align-items: center;
          height: 30vh;
        }

        #avatar:hover {
          filter: brightness(75%);
        }
        </style>
  </head>
  <body>
    <div class="form-container" style="max-width: 600px; margin: 0 auto;">
      <h2 style="text-align: center; font-family: 'Lucida Handwriting', cursive; font-size: 40px; color: #FFA500;"> 
        My Profile
      </h2>
      <form id="profileForm" enctype="multipart/form-data">
        <input type="file" id="imageInput">
        <div class="container">
          <img id="avatar" src="https://e7.pngegg.com/pngimages/799/987/png-clipart-computer-icons-avatar-icon-design-avatar-heroes-computer-wallpaper-thumbnail.png" alt="Avatar" style="width:200px">
        </div>
          <script>
          const imageInput = document.getElementById('imageInput');
          const avatarImg = document.getElementById('avatar');
          const logoImg = document.getElementById('logo');

          avatarImg.addEventListener('mouseover', () => {
            avatarImg.style.cursor = 'pointer';
            logoImg.style.display = 'block';
          });
          
          avatarImg.addEventListener('mouseout', () => {
            logoImg.style.display = 'none';
          });
    

          avatarImg.addEventListener('click', () => {
            imageInput.click();
          });
          imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
              const imageDataUrl = event.target.result;
              avatarImg.src = imageDataUrl;
            };
          });
          </script>
        <div class="form-group">
            <label for="firstName">Username</label>
            <input type="text" id="username" name="username" value="Karim123" readonly>
        </div>
        <div class="form-group">
          <label for="firstName">First Name</label>
          <input type="text" id="firstName" name="firstName" placeholder="Enter your first name" required>
        </div>
        <div class="form-group">
          <label for="lastName">Last Name</label>
          <input type="text" id="lastName" name="lastName" placeholder="Enter your last name" required>
        </div>
        <div class="form-group">
            <label>Hobbies</label>
            <div class="checkboxes">
              <label><input type="checkbox" name="hobby" value="coding">Coding</label>
              <label><input type="checkbox" name="hobby" value="reading">Reading</label>
              <label><input type="checkbox" name="hobby" value="painting">Painting</label>
              <label><input type="checkbox" name="hobby" value="gaming">Gaming</label>
              <label><input type="checkbox" name="hobby" value="hiking">Hiking</label>
              <label><input type="checkbox" name="hobby" value="dancing">Dancing</label>
              <label><input type="checkbox" name="hobby" value="singing">Singing</label>
              <label><input type="checkbox" name="hobby" value="traveling">Traveling</label>
              <label><input type="checkbox" name="hobby" value="shopping">Shopping</label>
              <label><input type="checkbox" name="hobby" value="exercising">Exercising</label>
              <label><input type="checkbox" name="hobby" value="drawing">Drawing</label>
              <label><input type="checkbox" name="hobby" value="cooking">Cooking</label>
            </div>
          </div>
          
          
        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" name="description" rows="4" cols="50" placeholder="Tell us about yourself" style="min-width: 600px; max-width:600px"></textarea>
        </div>
        <div class="form-group">
          <label for="location">Location</label>
          <select id="location" name="location" required>
            <option value="" disabled selected>Select a location</option>
            <script>
              // Loop through the hobbyDictionary object and create an option for each hobby
              for (var key in citydictionary) {
                if (citydictionary.hasOwnProperty(key)) {
                  document.write('<option value="' + key + '">' + citydictionary[key] + '</option>');
                }
              }
            </script>
          </select>
        </div>
        <div class="form-group">
          <label for="gender">Gender</label>
          <select id="gender" name="gender">
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>
        <div class="message">
          <div class="invalid" id="invalid">Error</div>
        </div>
        <div class="button-container">
          <button type="submit" class="btn">Save</button>
          <a href="/" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </body>

  <script>
    const user = currentProfile; // FIX
    // set the fields of everything not null

    const form = document.getElementById('ProfileForm');

    form.addEventListener('submit', function (event) {

      event.preventDefault(); // submitted are first name, last name, hobbies, description, location, gender
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const hobbies = [];
      const checkboxes = document.querySelectorAll('input[type="checkbox"][name="hobby"]'); // returns list of checkboxes
      checkboxes.forEach((cb) => {if (cb.checked) hobbies.push(cb.value);});
      const description = document.getElementById('description').value;
      const gender = document.getElementById('gender').value;
      const location = document.getElementById('location').value;
   
          fetch('/?', {
            method: 'POST',
            body: JSON.stringify({
              username : username,
              password : password
            }),
            headers: {"Content-Type":"application/json; charset=UTF-8" }
          })
          .then((res) => res.json())
          .then((data) => {
            if (data.status != 'ok')  {
              invalid.textContent = data.status;
              invalid.style.display = 'block';
            }
            else {
              invalid.textContent = "Login successful. Logging in...";
              invalid.style.display = 'block';
          //    setTimeout(function() { window.location.href = '/welcome';}, 10000);
            
            }
        })
          
        }
      );
    
  </script> <!-- FIX THIS -->
  
</html>
